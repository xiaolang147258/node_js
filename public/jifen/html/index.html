<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
  <!-- import CSS -->
  <title>积分评价系统</title>
  <script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.5/lib/index.css">
  <link rel="stylesheet" type="text/css" href="./css/topbox.css"/>
  <style type="text/css">
  	*{box-sizing: border-box;margin: 0;padding: 0;font-family:'PingFangSC-regular';}
	html{background: rgba(248, 248, 248, 1);}
	
  </style>
</head>
<body>
   <div id="meng" style="width:100%;height:100%;position:fixed;z-index:200;background:rgba(255,255,255,0.98);top:0;left:0;text-align:center;">
   	  <img style="width:1.333333rem;height:1.333333rem;margin-top:80%;" src="img/c4165dbea595b8cd5fe581cbe392deb3.gif" alt="">
   </div>
  <div id="app" style="padding-bottom: 1.566666rem;">
<!-- topbox  -->
	 <div class="topbox">
		<div class="box1">
			<img v-if="active.logo" :src="active.logo" alt="">
			<img v-else src="./img/16.png" alt="">
			<div class="namebox">
				<div style="width: 1.44rem;height: 0.72rem;color: rgba(16,16,16,1);font-size: 0.48rem;font-weight: bold;">{{active.name}}</div>
				<div style="width: 2.173333rem;height: 0.48rem;color: rgba(102,102,102,1);font-size: 0.32rem;margin-top: 0.213333rem;">{{active.group_name}}&nbsp;&nbsp;{{active.house_number}}</div>
			</div>
			<div @click="da" class="dfbox">我要打分</div>
		</div>
		<div class="box2">
			<div style="width:1.7rem;text-align: center;color:#F7840B;font-size:0.35rem;height:100%;padding-top:2.5606666rem;float:left;margin-right:1.246666rem;">
				{{active.indoor_hygiene_score}}分
			</div>
			<div style="width:2.52rem;text-align: center;color:rgba(253, 64, 64, 1);font-size:0.6rem;height:100%;padding-top:1.0rem;float:left;">
				{{active.current_envir_score}}分
			</div>
			<div style="width:1.49rem;text-align: center;color:rgba(62, 198, 47, 1);font-size:0.35rem;height:100%;padding-top:2.5606666rem;float:right;">
				{{active.outdoor_hygiene_score}}分
			</div>
			<!-- <div class="huanbox1">
			   <div style="width:2.133333rem;height:2.133333rem;">
				   <van-circle size="2.13rem" v-model="currentRate" :rate="active.indoor_hygiene_score" :speed="100"
				    layer-color="#ebedf0" color='#F7840B' :stroke-width="80" :text="active.indoor_hygiene_score+'分'"/>
			   </div><p>屋内卫生评分</p>
			</div>
			<div class="huanbox2">
				<div style="width:2.666666rem;height:2.666666rem;">
					<van-circle size="2.66rem" v-model="currentRate" :rate="active.current_envir_score" :speed="200"
					layer-color="#ebedf0" color='rgba(253, 64, 64, 1)' :stroke-width="85" :text="active.current_envir_score+'分'"/>
				</div><p>当前环境综合分</p>
			</div>
			<div class="huanbox3">
				<div style="width:2.133333rem;height:2.133333rem;">
					 <van-circle size="2.13rem" v-model="currentRate" :rate="active.outdoor_hygiene_score" :speed="100"
					layer-color="#ebedf0" color='rgba(62, 198, 47, 1)' :stroke-width="80" :text="active.outdoor_hygiene_score+'分'"/>
				</div><p>屋外卫生评分</p>
			</div> -->
		</div>		
	 </div>
	 
	 <div class="jfph">
		 <div class="phtop">
			 <img src="img/25.png" style="width: 0.786666rem;height: 0.546666rem;float: left;margin-top: 0.173333rem;">
			 <div class="ph">积分排行榜</div>
			 <img src="img/24.png" style="width: 0.786666rem;height: 0.546666rem;float: left;margin-top: 0.173333rem;">
		 </div>
		 <van-tabs @click="onClick" style='margin-bottom:0.813333rem;'>
		   <van-tab title="上月积分排行" name='1'></van-tab>
		   <van-tab title="年度积分排行" name='2'></van-tab>
		 </van-tabs>
		 
		<div style="width:100%;height:2.6rem;" v-for="(i,index) in activebox">
			<div style="height:100%;float:left;">
				<img v-if="index==0" style="width:0.666666rem;height:0.666666rem;float:left;margin-left:0.386666rem;" src="./img/23.png" alt="">
				<img v-else-if="index==1" style="width:0.666666rem;height:0.666666rem;float:left;margin-left:0.386666rem;" src="./img/27.png" alt="">
			    <div v-else class="inde">{{index}}</div>
			</div>
			<div style="width:8.206666rem;margin-left: 0.293333rem;height: 2.16rem;float:right;border-bottom:0.013333rem solid rgba(238, 238, 238, 1);margin-right:0.32rem;">
				<div class="msg-s">
					<img v-if="i.logo" :src="i.logo" id="img1">
					<img v-else src="img/16.png" id="img1">
					<div class="msg-name">{{i.name}}</div>
					<img src="img/党徽.png" id="img2">
				</div>
				<div class="msg-x">
					<div v-show="num==1" class="msg-pf">综合评分{{i.current_month_score}}分</div>
					<div class="msg-wpf">屋内卫生{{i.indoor_hygiene_score}}分</div>
					<div class="msg-wpf">屋外卫生{{i.outdoor_hygiene_score}}分</div>
			    </div>
			</div>
		</div>
	    <p v-show="activebox.length==0" style="text-align: center;color: rgba(138, 138, 138, 1);">没有数据</p>
	</div>
	  <div class="rzbottom">
	  		  <div class="rzbottom-select1">
	  			  <img  src="img/11.png">
	  			  <p >人居环境</p>
	  		  </div>
	  		  <div @click="to(2)" class="rzbottom-select2">
	  		  	 <img  src="img/12.png">
	  		  	 <p >红黑榜</p>
	  		  </div>
	  		  <div @click="to(3)" class="rzbottom-select3">
	  			 <img  src="img/17.png" >
	  			 <p >个人中心</p>
	  		  </div>
	  </div>
	</div> 
  </div>
</body>
  <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="./js/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vant@2.5/lib/vant.min.js"></script>
  <script>
	
	document.body.addEventListener("focusout", () => {//软键盘收起的事件处理
	  setTimeout(() => {
	    const scrollHeight =document.documentElement.scrollTop || document.body.scrollTop || 0;window.scrollTo(0, Math.max(scrollHeight - 1, 0));
	  }, 100);
	});
	
    new Vue({
      el: '#app',
	  computed:{
		text() {
		      return this.dat1 + '分'
		},
		getQueryString() { //获取顶部url参数
			return function (name){
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
		        var r = window.location.search.substr(1).match(reg); 
		        if (r != null) return unescape(r[2]); 
		        return null; 
			}
		  },
		
	  },
      data: function() {
        return {
			date_url:'http://192.168.124.9',
			// date_url:'',
			currentRate:0,
			dat1:40,
			dat2:40,
			dat3:40,
			active:{},
			num:1,
			activebox:[],
		}
      },
	  
	  mounted() {
		$('#meng').hide();
	    this.getJobList();
		this.git_active();
	  },
	  methods: {
		to(i){
			let id = this.getQueryString('house_id');
			console.log(id)
			window.location.href = i==2?'./HHB.html?house_id='+id:'./me(rz).html?house_id='+id;
		},
		onClick(title,name){//tab切换被点击
			this.num = name=='上月积分排行'?1:2;
			console.log(this.num)
			this.git_active();
		},
//获取列表数据
		git_active(){
		  vant.Toast.loading({ message: '加载中...',forbidClick:true});
		  let pams = {};
		  let url = this.num==1?'/xf/point_mobile/month_rank_list':'/xf/point_mobile/year_rank_list';
		  $.ajax({
		    url:this.date_url+url,
		    type: 'post',data:pams,dataType: 'json',
		    success: (res)=> {
		  	if(Object.prototype.toString.call(res) != '[object Object]'){res = JSON.parse(res)}
		  	  if ( res.code =='200' ) {
		  	  this.activebox = res.data;
			  console.log(this.activebox,'列表数据')
		  	  } else if ( res.code == '300' ) {
				  this.activebox = [];
		  	    vant.Toast.fail(res.msg);
		  	  }
			   vant.Toast.clear();
		    }
		  })
	    },
		
		
		da(){
		 let id = this.getQueryString('house_id');
		 if(localStorage.id){
			 window.location.href = 'PJ.html?house_id='+id
		 }else{
			 window.location.href = 'login.html?house_id='+id
		 }
		  
		},
	    /**
	     * 获取全部职位列表
	     */
	    getJobList() {
		  // vant.Toast.loading({ message: '加载中...',forbidClick:true});
		  $.ajax({
		    url:this.date_url+'/xf/point_mobile/family_point_detail?house_id='+this.getQueryString('house_id'),
		    type: 'get',dataType: 'json',
		    success: (res)=> {
		  	if(Object.prototype.toString.call(res) != '[object Object]'){res = JSON.parse(res)}
		  	  if ( res.code =='200' ) {
		  	  this.active = res.data;
			  localStorage.group = res.data.group_name
			  console.log(this.active,'top数据')
		  	  } else if ( res.code == '300' ) {
		  	    vant.Toast.fail(res.msg);
		  	  }
			   // vant.Toast.clear();
		    }
		  })
	    },
	    
	  }
    })
  </script>
  <style scoped="scoped">
	  .inde{
		  background: rgba(138, 138, 138, 1);
		  width:0.48rem;
		  height:0.48rem;
		  text-align: center;
		  line-height: 0.466666rem;
		  border-radius: 0.133333rem;
		  background-color: rgba(242, 242, 242, 1);
		  color: rgba(138, 138, 138, 1);
		  font-size: 0.32rem;
		  text-align: center;
		  font-family: Roboto;
		  border: 0.013333rem solid rgba(255, 255, 255, 0);
		  margin-left:0.48rem;
		  
	  }
	  .jfph{
	  	width: 100%;
	  	/* height: 22.346666rem; */
	  	padding:0.653333rem 0;
		padding-bottom:0.92rem;
	  	background-color: #FFFFFF;
	  }
	  .timeph{
	  	width: 100%;
	  	height: 0.44rem;
	  	margin: 0.693333rem auto;
	  }
	  .phtop{
	  	width: 5.36rem;
	  	height: 0.893333rem;
	  	margin: 0.653333rem auto;
		margin-top: 0;
		
	  }
	  .ph{
	  	width: 3.2rem;
	  	height: 0.893333rem;
	  	float: left;
	  	color: #333333;
	  	font-size: 0.64rem;
	  	margin-left: 0.293333rem;
	  	margin-right: 0.293333rem;
	  }
	  .monthp{
	  	width: 2.24rem;
	  	height: 0.44rem;
	  	color: #151515;
	  	font-size: 0.373333rem;
	  	text-align: center;
	  	margin-left: 1.6rem;
	  	float: left;
	  }
	  .yearp{
	  	width: 2.24rem;
	  	height: 0.44rem;
	  	color: #333333;
	  	font-size: 0.373333rem;
	  	text-align: center;
	  	margin-left:2.426666rem;
	  	float: left;
	  }
	  hr{
	  	width: 8.306666rem;
	  	margin: 0.413333rem auto ;
	  	border: 0.013333rem solid rgba(238, 238, 238, 1);
	  }
	  .msg-s{
	  	width: 8.306666rem;
	  	height: 0.8rem;
	  }
	  #img1{
	  	float: left;
	  	width: 0.8rem;
	  	height: 0.8rem;
	  	border-radius: 1000px;
	  	border: 0.013333rem solid rgba(240, 240, 240, 1);
	  }
	  .msg-name{
	  	float: left;
	  	height: 0.546666rem;
	  	color: rgba(16, 16, 16, 1);
	  	font-size: 0.373333rem;
	  	text-align: left;
	  	line-height: 0.546666rem;
	  	margin-left: 0.16rem;
	  	margin-top: 0.126666rem;
	  	font-family: SourceHanSansSC-regular;
	  }
	  #img2{
	  	float: left;
	  	width: 0.453333rem;
	  	height: 0.48rem;
	  	margin-left: 0.12rem;
	  	margin-top: 0.133333rem;
	  }
	  .msg-x{
	  	width: 8.306666rem;
	  	height: 0.613333rem;
	  	margin-top: 0.333333rem;
	  }
	  .msg-pf{
	  	float: left;
	  	width: 2.493333rem;
	  	height: 0.613333rem;
	  	margin-right: 0.2rem;
	  	line-height: 0.613333rem;
	  	border-radius: 0.04rem;
	  	background-color: rgba(253, 238, 236, 1);
	  	text-align: center;
	  	color: #FD4040;
	  	border: 0.013333rem solid rgba(255, 255, 255, 0);
	  	font-family: SourceHanSansSC-regular;
	  }
	  .msg-wpf{
	  	float: left;
	  	width: 2.493333rem;
	  	height: 0.613333rem;
	  	line-height: 0.613333rem;
	  	border-radius: 0.04rem;
	  	background-color: #F7F7F7;
	  	margin-left: 0.2rem;
	  	text-align: center;
	  	color: #8A8A8A;
	  	border: 0.013333rem solid rgba(255, 255, 255, 0);
	  	font-family: SourceHanSansSC-regular;
	  }
  </style>
</html>